#include <gtest/gtest.h>
#include "../../layer1-core/crypto/schnorr.h"

TEST(Schnorr, ValidVectorPasses)
{
    // BIP340 test vector 1
    const std::array<uint8_t,32> pubkey = {
        0xD6,0x39,0x9A,0xED,0x3B,0xB9,0xC5,0x99,0x5C,0x49,0x60,0x3C,0xA6,0x83,0xB5,0x4B,
        0xC1,0xC2,0x44,0x6B,0x65,0x99,0xB5,0x6E,0x13,0x9F,0xEE,0xD1,0x2B,0x6D,0x3B,0xE7};
    const std::array<uint8_t,64> sig = {
        0x4A,0x34,0x6C,0x8C,0xAD,0xB8,0x5E,0xB9,0x2B,0xAB,0x4E,0xAC,0xEC,0x06,0x8C,0x8A,
        0x11,0xA3,0xAC,0xB1,0x3D,0xF0,0x9B,0x5C,0xE2,0x7B,0xE8,0x9E,0x64,0x17,0xF5,0x0F,
        0x00,0x4D,0x2B,0xE1,0x36,0x36,0xF9,0xC2,0xA4,0xA1,0x2F,0xB8,0x70,0x4F,0xF5,0x16,
        0xE1,0xE8,0xB2,0x06,0x61,0xC2,0xAB,0xCA,0xAF,0xD9,0x0A,0x0F,0x8C,0xC1,0x70,0xF7};
    const std::vector<uint8_t> msg = {
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
    EXPECT_TRUE(VerifySchnorr(pubkey, sig, msg));
}

TEST(Schnorr, RejectsRandomData)
{
    std::array<uint8_t,32> pubkey{};
    pubkey.fill(1);
    std::array<uint8_t,64> sig{};
    sig.fill(2);
    std::vector<uint8_t> msg = {0xAA, 0xBB};
    EXPECT_FALSE(VerifySchnorr(pubkey, sig, msg));
}
